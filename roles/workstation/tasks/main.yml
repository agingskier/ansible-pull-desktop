---
- name: run all tasks from workstation role
  block:

    - name: include vars file
      tags: always
      include_vars: vault-secrets.yml

    ## desktop environments
    - include_tasks: desktop_environments/plank.yml
    - include_tasks: desktop_environments/tilix.yml
    - include_tasks: desktop_environments/desktop.yml

    ## system setup
    - import_tasks: system_setup/grub.yml
    - import_tasks: system_setup/sensors.yml

    - name: Check if /mnt/NAS already created
      stat:
        path: /mnt/NAS
      register: nas_status

    - import_tasks: system_setup/mounts.yml
      when: not nas_status.stat.exists

    ## install software
    - import_tasks: software/remove_software.yml
    - import_tasks: software/apt_update.yml
    - import_tasks: software/variety.yml
    - import_tasks: software/misc_packages.yml
    - import_tasks: software/filesearch.yml
    - import_tasks: software/kvm.yml
    - import_tasks: software/librecad.yml
#    - import_tasks: software/media.yml
    - import_tasks: software/misc_games.yml
    - import_tasks: software/multipass.yml
    - import_tasks: software/snap_packages.yml
    - import_tasks: software/steam.yml
    - import_tasks: software/terminator.yml
    - import_tasks: software/topgrade.yml
    - import_tasks: software/vagrant.yml
    - import_tasks: software/virtualbox.yml
    - import_tasks: software/vlc.yml

    ## User configs
#    - import_tasks: system_setup/wifi.yml
    - import_tasks: users/bernhard.yml

  rescue:
    - name: set task failed variable
      set_fact: task_failed=true
