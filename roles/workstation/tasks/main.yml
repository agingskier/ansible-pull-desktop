---
- name: run all tasks from workstation role
  block:

    - name: include vars file
      tags: always
      include_vars: vault-secrets.yml

    ## desktop environments
#    - include_tasks: desktop_environments/plank.yml        # no plank on ubuntu
#    - include_tasks: desktop_environments/desktop.yml      # not possible for ubuntu

    ## system setup

    - import_tasks: system_setup/sensors.yml
    - name: Check if /mnt/NAS already created
      stat:
        path: /mnt/NAS
      register: nas_status

    - import_tasks: system_setup/mounts.yml
      when: not nas_status.stat.exists

    ## Development
    - import_tasks: development/geany.yml
    - import_tasks: development/java.yml
    - import_tasks: development/vscodium.yml
    - import_tasks: development/development.yml

    ## install software
#    - import_tasks: software/calibre.yml
    - import_tasks: software/keepassxc.yml
    - import_tasks: software/variety.yml
    - import_tasks: software/fsearch.yml
    - import_tasks: software/gimp.yml
    - import_tasks: software/ipscan.yml
    - import_tasks: software/librecad.yml
    - import_tasks: software/media.yml
    - import_tasks: software/games.yml
    - import_tasks: software/steam.yml
    - import_tasks: software/snap_packages.yml
    - import_tasks: software/vlc.yml
    - import_tasks: software/protonvpn.yml

    ## Virtualization
    - import_tasks: virtualization/kvm.yml
    - import_tasks: virtualization/vagrant.yml
    - import_tasks: virtualization/virtualbox.yml
    - import_tasks: virtualization/multipass.yml

    ## User configs
    - import_tasks: users/bernhard.yml

  rescue:
    - name: set task failed variable
      set_fact: task_failed=true

  when:
    - task_failed is not defined
