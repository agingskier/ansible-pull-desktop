---
# Install cool utilities specified under modern-unix plus zsh and nerd fonts
#

- name: software | lsd | install fontconfig utilities
  apt:
    pkg:
      - fontconfig
 
# Get latest release from Github api
# get tag line
# pluck JSON value
- name: software | lsd | download latest release info
  ansible.legacy.shell: |
    set -o pipefail
    curl --silent "https://api.github.com/repos/lsd-rs/lsd/releases/latest" |
    jq -r .tag_name
  args:
    executable: /bin/bash
  register: lsd_release
  changed_when: lsd_release.rc == 0

- name: software | lsd | Print latest release
  debug:
    var: lsd_release.stdout
    verbosity: 2

- name: software | lsd | install lsd program
  apt:
    deb: https://github.com/lsd-rs/lsd/releases/download/{{ lsd_release.stdout }}/lsd_{{ lsd_release.stdout }}_amd64.deb

# Get latest release from Github api
# get tag line
# pluck JSON value
- name: software | lsd | download latest release info for lsd nerd fonts
  ansible.legacy.shell: |
    set -o pipefail
    curl --silent https://api.github.com/repos/ryanoasis/nerd-fonts/releases/latest |
    jq -r .tag_name
  args:
    executable: /bin/bash
  register: fonts_release
  changed_when: fonts_release.rc == 0

- name: software | lsd | Print latest lsd nerd fonts release
  debug:
    var: fonts_release.stdout
    verbosity: 2

- name: software | lsd | Creates nerd fonts directory used by lsd
  file:
    path: /usr/local/share/fonts/nerd
    state: directory
    owner: root
    group: root
    mode: 0775

- name: software | lsd | download and install JetBrains and FiraCode nerd fonts
  become: true
  become_method: sudo
  unarchive:
    src: https://github.com/ryanoasis/nerd-fonts/releases/download/{{ fonts_release.stdout }}/{{ item }}
    dest: /usr/local/share/fonts/nerd
    remote_src: yes
    owner: root
    group: root
    mode: 0644
  with_items:
    - JetBrainsMono.zip
    - FiraCode.zip

- name: software | lsd | create cache for new fonts
  command: fc-cache -v -f
  register: create_cache
  changed_when: create_cache.rc == 0
