---
- name: users | add groups to user bernhard | update password
  user:
    name: bernhard
    group: users
    groups: adm,cdrom,sudo,dip,plugdev,lpadmin,lxd,sambashare
    uid: 10000
    state: present
    comment: "Bernhard Picenoni"
    update_password: always
    password: "{{ bernhard_passwd }}"
    shell: /bin/bash

- name: users | bernhard | add sudoers file
  copy:
    src: users/sudoers_bernhard
    dest: /etc/sudoers.d/bernhard
    owner: root
    group: root
    mode: 0440

#
# These two tasks are done in playbook "seed" prior to ansible-pull
#
#- name: users | bernhard | create .ssh directory
#  tags: dotfiles,bernhard,ssh,users
#  file:
#    path: "{{ item.dir }}"
#    state: directory
#    owner: bernhard
#    group: users
#    mode: 0700
#  with_items:
#    - { dir: '/home/bernhard/.ssh' }

#- name: users | bernhard | add public key
#  tags: dotfiles,bernhard,ssh,ssh-keys,users
#  authorized_key:
#    user: bernhard
#    key: "{{ lookup('file', 'users/bernhard/ssh/id_ed25519_ubuntu.pub') }}"

- name: users | bernhard | create vim directories
  file:
    path: /home/bernhard/{{ item.dir }}
    state: directory
    owner: bernhard
    group: users
    mode: 0700
  with_items:
    - { dir: '.vim' }
    - { dir: '.vim/autoload' }
    - { dir: '.vim/bundle' }
    - { dir: '.vim/colors' }
    - { dir: '.vim/ftplugin' }

- name: users | bernhard | copy dotfiles
  copy:
    src: users/bernhard/{{ item.src }}
    dest: /home/bernhard/{{ item.dest }}
    owner: bernhard
    group: users
    mode: 0600
  with_items:
    - { src: 'bash/bash_aliases', dest: '.bash_aliases' }
    - { src: 'bash/bash_functions', dest: '.bash_functions' }
    - { src: 'bash/bashrc', dest: '.bashrc' }
    - { src: 'bash/dircolors', dest: '.dircolors' }
    - { src: 'bash/conkyrc', dest: '.conkyrc' }
    - { src: 'bash/tilix-split.json', dest: 'tilix-split.json' }
    - { src: 'vim/vimrc', dest: '.vimrc' }
    - { src: 'vim/gvimrc', dest: '.gvimrc' }
    - { src: 'autostart/conky_autostart', dest: '.config/autostart/conky.desktop' }
    - { src: 'autostart/tilix_autostart', dest: '.config/autostart/tilix.desktop' }
    - { src: 'tmux/tmux_config', dest: '.tmux.conf' }
    - { src: 'tmux/tmux_setup_config', dest: 'tmux-setup.conf'}

- name: users | bernhard | copy vim ftype files
  copy:
    src: users/bernhard/vim/{{ item.src }}
    dest: /home/bernhard/.vim/ftplugin/{{ item.src }}
    owner: bernhard
    group: users
    mode: 0600
  with_items:
    - { src: 'cmake.vim' }
    - { src: 'cpp.vim' }
    - { src: 'html.vim' }
    - { src: 'perl.vim' }
    - { src: 'python.vim' }
    - { src: 'ruby.vim' }
    - { src: 'sql.vim' }
    - { src: 'xml.vim' }

- name: users | bernhard | git checkout vim color schemes and pathogen
  become: true
  git:
    repo: "{{ item.repo }}"
    dest: "{{ item.dest }}"
    version: master
    force: true
  with_items:
    - { repo: 'https://github.com/tpope/vim-pathogen.git', dest: '/home/bernhard/.vim/autoload/pathogen.vim'}
    - { repo: 'https://github.com/nanotech/jellybeans.vim.git', dest: '/home/bernhard/.vim/colors/jellybeans.vim'}
    - { repo: 'https://github.com/vim-scripts/xoria256.vim.git', dest: '/home/bernhard/.vim/colors/xoria256.vim'}
    - { repo: 'https://github.com/jnurmine/Zenburn.git', dest: '/home/bernhard/.vim/colors/zenburn.vim'}

- name: users | bernhard | git checkout bundle repositories
  become: true
  git:
    repo: "{{ item.repo }}"
    dest: "{{ item.dest }}"
    version: master
    force: true
  with_items:
    - { repo: 'https://github.com/itchyny/lightline.vim.git', dest: '/home/bernhard/.vim/bundle/lightline.vim'}  # status line
#    - { repo: 'https://github.com/ctrlpvim/ctrlp.vim.git', dest: '/home/bernhard/.vim/bundle/ctrlp.vim' }
#    - { repo: 'https://github.com/davidhalter/jedi-vim.git', dest: '/home/bernhard/.vim/bundle/jedi-vim' }
#    - { repo: 'https://github.com/pearofducks/ansible-vim', dest: '/home/bernhard/.vim/bundle/ansible-vim' }
#    - { repo: 'https://github.com/rhysd/vim-grammarous.git', dest: '/home/bernhard/.vim/bundle/vim-grammarous' }
#    - { repo: 'https://github.com/ron89/thesaurus_query.vim', dest: '/home/bernhard/.vim/bundle/thesaurus_query' }
#    - { repo: 'https://github.com/scrooloose/nerdtree.git', dest: '/home/bernhard/.vim/bundle/nerdtree' }
#    - { repo: 'https://github.com/tpope/vim-obsession.git', dest: '/home/bernhard/.vim/bundle/vim-obsession' }
#    - { repo: 'https://github.com/vim-syntastic/syntastic.git', dest: '/home/bernhard/.vim/bundle/syntastic' }
  notify: update_vim_bundle_perms

