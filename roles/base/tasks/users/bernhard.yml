---
- name: users | bernhard block
  block:
# define these variables in host_vars
#    - name: users | bernhard | user name fact
#      set_fact:
#        user_name: 'bernhard'
#        group_name: 'users'

    - name: users | bernhard | add sudoers file
      copy:
        src: users/sudoers_bernhard
        dest: /etc/sudoers.d/bernhard
        owner: root
        group: root
        mode: 0440

    - name: users | bernhard | copy dotfiles
      copy:
        src: users/{{ user_name }}/{{ item.src }}
        dest: /home/{{ user_name }}/{{ item.dest }}
        owner: "{{ user_name }}"
        group: "{{ group_name }}"
        mode: 0600
      with_items:
        - { src: 'bash/bash_aliases', dest: '.bash_aliases' }
        - { src: 'bash/bash_functions', dest: '.bash_functions' }
        - { src: 'bash/bashrc', dest: '.bashrc' }
        - { src: 'bash/dircolors', dest: '.dircolors' }
        - { src: 'bash/tilix-split.json', dest: 'tilix-split.json' }
        - { src: 'autostart/conky_autostart', dest: '.config/autostart/conky.desktop' }
        - { src: 'autostart/tilix_autostart', dest: '.config/autostart/tilix.desktop' }
        - { src: 'tmux/tmux_config', dest: '.tmux.conf' }
        - { src: 'tmux/tmux_setup_config', dest: 'tmux-setup.conf'}

    - name: users | bernhard | conky | synchronize ~/conky directory with NAS backup
      ansible.posix.synchronize:
        src: /mnt/NAS/backup/{{ hostvars[inventory_hostname].ansible_hostname }}/conky/
        dest: /home/bernhard/conky/
        archive: yes

    - name: users | bernhard | import tasks for vim
      import_tasks: ../software/vim.yml

    - name: users | bernhard | import tasks for zsh
      import_tasks: ../software/zsh.yml
      
    - name: users | bernhard | import tasks for tmux
      import_tasks: ../software/tmux.yml
  when:
    - bernhard is defined
    - bernhard
